<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>SEA ìˆ˜ë¦¬&amp;ì¬ê°€ê³µ í˜„í™©</title>

<link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
<link rel="manifest" href="./site.webmanifest">

<!-- ===== ë¯¸ë¦¬ë³´ê¸°: ì´ë¯¸ì§€ ì—†ì´ í…ìŠ¤íŠ¸ë§Œ ë…¸ì¶œ ===== -->
<meta name="description" content="ìì¬íŒ€Â·êµ¬ë§¤íŒ€ì„ ìœ„í•œ ì‹¤ì‹œê°„ ìˆ˜ë¦¬Â·ì¬ê°€ê³µ í˜„í™© ê´€ë¦¬ ì›¹ì‚¬ì´íŠ¸">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:title" content="SEA ìˆ˜ë¦¬&amp;ì¬ê°€ê³µ í˜„í™©">
<meta property="og:description" content="ìì¬íŒ€Â·êµ¬ë§¤íŒ€ì„ ìœ„í•œ ì‹¤ì‹œê°„ ìˆ˜ë¦¬Â·ì¬ê°€ê³µ í˜„í™© ê´€ë¦¬ ì›¹ì‚¬ì´íŠ¸">
<meta property="og:url" content="https://johnchoi112.github.io/repair-sea/">
<meta property="og:site_name" content="SEA í˜„í™©">
<meta property="og:locale" content="ko_KR">

<!-- Twitter Card (í…ìŠ¤íŠ¸í˜•) -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SEA ìˆ˜ë¦¬&amp;ì¬ê°€ê³µ í˜„í™©">
<meta name="twitter:description" content="ìì¬íŒ€Â·êµ¬ë§¤íŒ€ì„ ìœ„í•œ ì‹¤ì‹œê°„ ìˆ˜ë¦¬Â·ì¬ê°€ê³µ í˜„í™© ê´€ë¦¬ ì›¹ì‚¬ì´íŠ¸">

<style>
  * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
  body { background: #f5f7fa; margin: 0; padding: 20px; }
  .container { max-width: 2000px; margin: 0 auto; }
  .header { text-align: center; padding: 20px; margin-bottom: 60px;
            border-radius: 15px; color:#fff;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 8px 32px rgba(0,0,0,.1); position: relative; }
  .header h1 { margin: 0; font-size: 2.1rem; font-weight: 800; letter-spacing: .02em; }

  .controls { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:20px; margin-top: 60px; }
  .btn { padding: 10px 16px; border:0; border-radius:8px; color:#fff; cursor:pointer; font-weight:700;
         box-shadow: 0 4px 14px rgba(0,0,0,.12); }
  .btn-add { background: linear-gradient(135deg, #4CAF50, #45a049); }
  .btn-del { background: linear-gradient(135deg, #f44336, #da190b); }
  .btn-reg { background: linear-gradient(135deg, #2196F3, #1976D2); }

  .table-container { background:#fff; border-radius:15px; box-shadow:0 8px 32px rgba(0,0,0,.08); overflow:hidden; max-height: 650px; overflow-y: auto;
                      position: relative; } /* ì •ë ¬ ë„í¬ ë°°ì¹˜ë¥¼ ìœ„í•´ relative */
  table { width: 100%; border-collapse: collapse; table-layout: auto; }
  th, td { border:1px solid #e0e0e0; text-align:center; padding:10px 6px; }
  thead th { position: sticky; top:0; z-index:10; color:#fff;
             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
  tr:nth-child(even) { background:#fafafa; }
  tr:hover { background:#f1f6ff; }

  input[type="date"], select { width:100%; padding:6px 8px; border:1px solid #ddd; border-radius:6px; font-size:.9rem; color: #000; }
  .filter-input { width: 100%; padding: 5px 6px; border:1px solid #ddd; border-radius:6px; margin-top:6px; font-size:.8rem; }

  [contenteditable] { padding:6px; min-height:24px; border:1px solid transparent; border-radius:6px; }
  [contenteditable]:hover { border-color:#e3e3e3; }
  [contenteditable]:focus { outline:0; border-color:#2196F3; background:#fff3e0; }

  /* ë„ˆë¹„ íŠœë‹ */
  #mainTable th:nth-child(4),  #mainTable td:nth-child(4)  { min-width: 100px; } /* ê±°ë˜ì²˜ */
  #mainTable th:nth-child(5),  #mainTable td:nth-child(5)  { min-width: 100px; } /* í’ˆë²ˆ */
  #mainTable th:nth-child(6),  #mainTable td:nth-child(6)  { min-width: 100px; } /* í’ˆëª… */
  #mainTable th:nth-child(7),  #mainTable td:nth-child(7)  { min-width: 130px; } /* ê·œê²© */
  #mainTable th:nth-child(10), #mainTable td:nth-child(10) { min-width: 160px; } /* ìƒíƒœ */
  #mainTable th:nth-child(11), #mainTable td:nth-child(11) { min-width: 60px; }  /* ìˆ˜ë¦¬ìš”ì²­ì */
  #mainTable th:nth-child(12), #mainTable td:nth-child(12) { min-width: 100px; } /* ì—°ë½ì²˜ */
  #mainTable th:nth-child(14), #mainTable td:nth-child(14) { min-width: 60px; }  /* ìˆ˜ë¦¬ë¹„ìš© */
  #mainTable th:nth-child(15), #mainTable td:nth-child(15) { min-width: 100px; } /* ë¹„ê³  */

  /* ëª¨ë‹¬ */
  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:999; }
  .modal-content { width: 420px; max-width: calc(100vw - 40px); margin: 5% auto; background:#fff; border-radius:12px;
                   padding: 16px; box-shadow:0 20px 60px rgba(0,0,0,.3); }
  .modal-header { text-align:center; font-weight:800; margin-bottom:12px; }
  .modal-table { width:100%; border-collapse: collapse; table-layout: fixed; }
  .modal-table th, .modal-table td { border:1px solid #eee; padding:6px 8px; font-size:.9rem; text-align:center; }
  .modal-table th { width: 110px; background:#fafafa; }
  .modal-input { width: 100%; padding:6px 8px; border:1px solid #ddd; border-radius:6px; color: #000; }
  .modal-footer { text-align:center; margin-top:10px; }
  .modal-btn { padding:9px 16px; border:0; border-radius:6px; cursor:pointer; color:#fff; font-weight:700; }
  .ok { background: linear-gradient(135deg, #4CAF50, #45a049); }
  .cancel { background: linear-gradient(135deg, #f44336, #da190b); margin-left:6px; }

 .sub-desc {
  margin-top: 6px;
  font-size: 0.95rem;
  color: #f0f0f0;
  font-weight: 400;
}

.author {
  position: absolute;
  right: 30px;
  top: 16px; /* ê¸°ì¡´ 26pxì—ì„œ ì¤„ì„ */
  font-size: 0.9rem;
  color: #ffffff;
  font-weight: bold;
  text-align: right;
  line-height: 1.2;
}

.header {
  position: relative; /* author ìœ„ì¹˜ ê³ ì •ìš© */
  text-align: center;
  padding: 20px;
  margin-bottom: 30px;
  border-radius: 15px;
  color: #fff;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  box-shadow: 0 8px 32px rgba(0,0,0,.1);
}

.header .logo {
  position: absolute;
  left: 24px;
  top: 50%;
  transform: translateY(-50%);
  height: 64px;
  width: auto;
  user-select: none;
  pointer-events: none;
}

/* í•œ ë‹¨ê³„ ë” ì§„í•˜ê²Œ */
tr.row-status-received { background: linear-gradient(90deg, #cfe2ff 0%, #e0ecff 100%) !important; }
tr.row-status-repairing { background: linear-gradient(90deg, #cdebd6 0%, #e2f5ea 100%) !important; }
tr.row-status-free     { background: linear-gradient(90deg, #ffeec6 0%, #ffe7b0 100%) !important; }
tr.row-status-paid     { background: linear-gradient(90deg, #dcdcdc 0%, #e9e9e9 100%) !important; }

/* í˜¸ë²„ìƒ‰ì´ ë®ì§€ ì•Šë„ë¡ ë™ì¼ ìœ ì§€ */
tr.row-status-received:hover,
tr.row-status-repairing:hover,
tr.row-status-free:hover,
tr.row-status-paid:hover { filter: brightness(1.0); }

/* í‘œ í–‰ ë°°ê²½ ì „í™˜: ë¶€ë“œëŸ½ê²Œ */
#mainTable tbody tr { transition: background 240ms ease-in-out; }

/* === ëª¨ë°”ì¼(í•¸ë“œí°)ì—ì„œ í‘œ ì¢Œìš° ìŠ¤ì™€ì´í”„ í—ˆìš© === */
@media (max-width: 820px) {
  .table-container {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  #mainTable { min-width: 1100px; }
}

/* === ëª¨ë°”ì¼ í—¤ë”: ì¶•ì†Œ + ìƒë‹¨ ê³ ì •(ê¸°ëŠ¥ ì˜í–¥ ì—†ìŒ) ===================== */
@media (max-width: 820px) {
  .header {
    position: sticky;
    top: 0;
    z-index: 50;
    padding: 12px 16px;
    margin-bottom: 16px;
    border-radius: 12px;
    overflow: hidden;
  }
  .header .logo { left: 12px; height: 36px; }
  .header h1 { font-size: 1.25rem; margin: 0; line-height: 1.1; word-break: keep-all; }
  .sub-desc { font-size: .80rem; margin-top: 4px; }
  .author { top: 8px; right: 12px; font-size: .75rem; line-height: 1.1; }
}

/* ì´ˆì†Œí˜• ê¸°ê¸°(ì„¸ë¡œ 360~400px)ì—ì„œ í•œ ë‹¨ê³„ ë” ì¶•ì†Œ */
@media (max-width: 400px) {
  .header { padding: 10px 12px; }
  .header .logo { height: 30px; left: 10px; }
  .header h1 { font-size: 1.1rem; }
  .sub-desc { font-size: .74rem; }
  .author { font-size: .7rem; top: 6px; right: 10px; }
}

/* === ëª¨ë°”ì¼ì—ì„œ ë¡œê³ /ì œì‘ì í…ìŠ¤íŠ¸ ë” ì‘ê²Œ + ê²¹ì¹¨ ë°©ì§€ ============= */
@media (max-width: 820px) {
  .header h1, .header .sub-desc, .header .author { position: relative; z-index: 1; }
  .header .logo { z-index: 0; }
  .header .logo { height: 26px; left: 10px; }
  .author { font-size: 0.62rem; top: 6px; right: 8px; line-height: 1.1; }
}

/* ì´ˆì†Œí˜• ê¸°ê¸°ì—ì„œ í•œ ë‹¨ê³„ ë” ì¶•ì†Œ */
@media (max-width: 400px) {
  .header .logo { height: 22px; left: 8px; }
  .author { font-size: 0.58rem; top: 5px; right: 6px; }
}

/* === í•¸ë“œí°ì—ì„œë§Œ SEA ë¡œê³  ìˆ¨ê¸°ê¸° (ì›¹ì€ ê·¸ëŒ€ë¡œ) === */
@media (pointer: coarse) and (max-width: 820px) {
  .header .logo { display: none !important; }
}

/* --- ì •ë ¬ ë²„íŠ¼(ì¹©) --- */
.sort-dock {
  position: absolute;
  top: -14px;            /* í…Œë‘ë¦¬ ë°– ìœ„ìª½ */
  right: 12px;           /* ë¹„ê³  í—¤ë” ì˜¤ë¥¸ìª½ê³¼ ìì—°ìŠ¤ëŸ½ê²Œ */
  display: inline-flex;
  gap: 6px;
  align-items: center;
  z-index: 20;
}
.sort-btn {
  font-size: 0.72rem;
  padding: 5px 10px;
  background: #ffffff;
  color: #333;
  border: 1px solid #d8dbe3;
  border-radius: 999px;  /* ì¹© í˜•íƒœ */
  cursor: pointer;
  user-select: none;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
  transition: all .18s ease;
}
.sort-btn:hover { background:#f7f8fc; border-color:#c9cdd8; }
.sort-btn.active { background:#eef2ff; border-color:#a5b4fc; color:#334155; }

/* --- [ì¦ìƒ][ì§„ë‹¨ ê²°ê³¼] ê³ ì • ìˆ¨ê¹€(CSS) --- */
/* 1í–‰ theadì™€ tbody ëª¨ë‘ 8,9ë²ˆì§¸ ì»¬ëŸ¼ì„ ìˆ¨ê¸´ë‹¤(ì²´í¬ë°•ìŠ¤ ì—´ í¬í•¨ ê¸°ì¤€) */
#mainTable thead tr:first-child th:nth-child(8),
#mainTable thead tr:first-child th:nth-child(9),
#mainTable tbody tr td:nth-child(8),
#mainTable tbody tr td:nth-child(9) {
  display: none !important;
}
</style>
</head>
<body>
<div class="header">
 <img src="./logo.avif" alt="SEA logo" class="logo" />
  <h1>SEA ìˆ˜ë¦¬&amp;ì¬ê°€ê³µ í˜„í™©</h1>
  <p class="sub-desc">
    ì´ ì›¹ì‚¬ì´íŠ¸ëŠ” ìì¬íŒ€ê³¼ êµ¬ë§¤íŒ€ì„ ìœ„í•œ ì‹¤ì‹œê°„ ìˆ˜ë¦¬Â·ì¬ê°€ê³µ í˜„í™© ê´€ë¦¬ìš© ì›¹ì‚¬ì´íŠ¸ ì…ë‹ˆë‹¤.
  </p>
  <div class="author">
    <strong>made by JH</strong> <span class="contact">(010-4747-2421)</span>
  </div>
</div>

<div class="controls">
  <button class="btn btn-add" id="btnAdd">[í–‰ ì¶”ê°€]</button>
  <button class="btn btn-del" id="btnDelete">[í–‰ ì‚­ì œ]</button>
  <button class="btn btn-reg" id="btnOpen">[ì ‘ìˆ˜]</button>
</div>

  <div class="table-container">
    <!-- ğŸ”½ í…Œë‘ë¦¬ ë°–, ìš°ì¸¡ ìƒë‹¨ì— ì •ë ¬ ë„í¬ -->
    <div id="sortDock" class="sort-dock" aria-label="ì •ë ¬ ì»¨íŠ¸ë¡¤">
      <button class="sort-btn" data-field="receiptDate">ì ‘ìˆ˜ì¼ìâ†‘â†“</button>
      <button class="sort-btn" data-field="shipDate">ë°œì†¡ì¼ìâ†‘â†“</button>
      <button class="sort-btn" data-field="completeDate">ì™„ë£Œì¼â†‘â†“</button>
      <button class="sort-btn" data-reset>ì •ë ¬ ì´ˆê¸°í™”</button>
    </div>

    <table id="mainTable">
      <thead>
        <tr>
          <th><input type="checkbox" id="checkAll" /></th>
          <th>ì ‘ìˆ˜ì¼ì<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(1,this.value)" /></th>
          <th>ë°œì†¡ì¼ì<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(2,this.value)" /></th>
          <th>ê±°ë˜ì²˜<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(3,this.value)" /></th>
          <th>í’ˆë²ˆ<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(4,this.value)" /></th>
          <th>í’ˆëª…<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(5,this.value)" /></th>
          <th>ê·œê²©<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(6,this.value)" /></th>
          <th>ì¦ìƒ<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(7,this.value)" /></th>
          <th>ì§„ë‹¨ ê²°ê³¼<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(8,this.value)" /></th>
          <th>ìƒíƒœ<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(9,this.value)" /></th>
          <th>ìˆ˜ë¦¬ ìš”ì²­ì<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(10,this.value)" /></th>
          <th>ì—°ë½ì²˜<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(11,this.value)" /></th>
          <th>ìˆ˜ë¦¬ì™„ë£Œì¼<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(12,this.value)" /></th>
          <th>ìˆ˜ë¦¬ë¹„ìš©<br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(13,this.value)" /></th>
          <th>ë¹„ê³ <br/><input class="filter-input" placeholder="í•„í„°" onkeyup="filterTable(14,this.value)" /></th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- ì‹¤ì‹œê°„ìœ¼ë¡œ Firestore ë¬¸ì„œë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤ -->
      </tbody>
    </table>
  </div>
</div>

<!-- ì ‘ìˆ˜ ëª¨ë‹¬ -->
<div id="registerModal"
    class="modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="registerTitle"
    aria-hidden="true">
  <div class="modal-content" tabindex="-1">
    <h2 class="modal-header" id="registerTitle">ì‹ ê·œ ì ‘ìˆ˜ ë“±ë¡</h2>
    <table class="modal-table">
      <tr><th>ì ‘ìˆ˜ì¼ì</th><td><input id="mReceipt" type="date" class="modal-input" /></td></tr>
      <tr><th>ê±°ë˜ì²˜</th><td><input id="mCompany" type="text" class="modal-input" maxlength="50" /></td></tr>
      <tr><th>í’ˆë²ˆ</th><td><input id="mPartNo" type="text" class="modal-input" maxlength="50" /></td></tr>
      <tr><th>í’ˆëª…</th><td><input id="mPartName" type="text" class="modal-input" maxlength="100" /></td></tr>
      <tr><th>ê·œê²©</th><td><input id="mSpec" type="text" class="modal-input" maxlength="100" /></td></tr>
      <tr><th>ì¦ìƒ</th><td><input id="mSymptom" type="text" class="modal-input" maxlength="200" /></td></tr>
      <tr><th>ìš”ì²­ì¸</th><td><input id="mRepairer" type="text" class="modal-input" maxlength="50" /></td></tr>
      <tr><th>ì—°ë½ì²˜</th><td><input id="mContact" type="text" class="modal-input" maxlength="50" /></td></tr>
      <tr><th>ë¹„ê³ </th><td><input id="mNote" type="text" class="modal-input" maxlength="300" /></td></tr>
    </table>
    <div class="modal-footer">
      <button class="modal-btn ok" id="mOk">[í™•ì¸]</button>
      <button class="modal-btn cancel" id="mCancel">[ì·¨ì†Œ]</button>
    </div>
  </div>
</div>

<!-- ì•± ìŠ¤í¬ë¦½íŠ¸ -->
<script type="module" src="./js/main.js"></script>

<!-- í–‰ ìƒíƒœìƒ‰ ì ìš© & ì´ˆê¸° ì™€ì´ì–´ë§ -->
<script>
(function(){
  const MAP = {
    "ì ‘ìˆ˜ì™„ë£Œ": "row-status-received",
    "ìˆ˜ë¦¬ ì¤‘": "row-status-repairing",
    "ìˆ˜ë¦¬ì¤‘": "row-status-repairing",
    "ë¬´ìƒìˆ˜ë¦¬ì™„ë£Œ": "row-status-free",
    "ìœ ìƒìˆ˜ë¦¬ì™„ë£Œ": "row-status-paid"
  };
  const ALL = Object.values(MAP);

  function applyStyle(row, value){
    row.classList.remove(...ALL);
    const cls = MAP[(value||"").trim()];
    if (cls) row.classList.add(cls);
  }

  function wireRow(row){
    const sel = row && row.querySelector('select[data-key="status"]');
    if (!sel || sel._rowStyleWired) return;
    sel._rowStyleWired = true;
    applyStyle(row, sel.value);
    sel.addEventListener('change', () => applyStyle(row, sel.value));
  }

  function init(){
    const tbody = document.getElementById('tableBody');
    if (!tbody) return;
    tbody.querySelectorAll('tr').forEach(wireRow);
    new MutationObserver(muts => {
      muts.forEach(m => m.addedNodes.forEach(n => {
        if (n.nodeType === 1 && n.tagName === 'TR') wireRow(n);
      }));
    }).observe(tbody, { childList: true });
  }

  document.readyState === 'loading' ?
    document.addEventListener('DOMContentLoaded', init) : init();
})();
</script>

<!-- ì •ë ¬ ê¸°ëŠ¥ + ìˆ¨ê¹€ ë³´ê°•(ì´ˆê¸°/ë™ì ) -->
<script>
(function(){
  /* -------------------- 1) [ì¦ìƒ][ì§„ë‹¨ ê²°ê³¼] ê°•ì œ ìˆ¨ê¹€ -------------------- */
  const HIDE_INDEXES = [8, 9]; // 1-based: ì²´í¬ë°•ìŠ¤ í¬í•¨ ê¸°ì¤€

  function hideColsNow(root = document){
    // thead 1í–‰
    const headRow = root.querySelector('#mainTable thead tr');
    if (headRow) {
      HIDE_INDEXES.forEach(i => { const th = headRow.children[i-1]; if (th) th.style.display = 'none'; });
    }
    // tbody ëª¨ë“  í–‰
    root.querySelectorAll('#mainTable tbody tr').forEach(tr => {
      HIDE_INDEXES.forEach(i => { const td = tr.children[i-1]; if (td) td.style.display = 'none'; });
    });
  }

  function observeForNewRows(){
    const tbody = document.getElementById('tableBody');
    if (!tbody) return;
    new MutationObserver(muts => {
      muts.forEach(m => m.addedNodes.forEach(n => {
        if (n.nodeType === 1 && n.tagName === 'TR') {
          HIDE_INDEXES.forEach(i => { const td = n.children[i-1]; if (td) td.style.display = 'none'; });
        }
      }));
    }).observe(tbody, { childList: true });
  }

  // DOM ì¤€ë¹„ ì‹œ 1íšŒ ê°•ì œ ìˆ¨ê¹€
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => { hideColsNow(); observeForNewRows(); });
  } else {
    hideColsNow(); observeForNewRows();
  }

  /* -------------------- 2) ì •ë ¬ ê¸°ëŠ¥ -------------------- */
  const dock = document.getElementById('sortDock');
  if (!dock) return;

  // ì›ë˜ ìˆœì„œ ì €ì¥(ì‹¤ì‹œê°„ ì¶”ê°€/ì‚­ì œ ë°˜ì˜)
  let sortedActive = false;
  const originalOrder = []; // [{tr, ex}]
  const idSet = new Set();

  function captureInitialOrderFor(tr){
    if (tr.classList.contains('expand-row')) return;
    if (!tr.dataset || !tr.dataset.id) return;
    if (idSet.has(tr.dataset.id)) return;
    idSet.add(tr.dataset.id);
    const ex = tr.nextElementSibling?.classList.contains('expand-row') ? tr.nextElementSibling : null;
    originalOrder.push({ tr, ex });
  }

  function buildObserver(){
    const tbody = document.getElementById('tableBody');
    if (!tbody) return;
    // ê¸°ì¡´ í–‰ ìˆ˜ì§‘
    tbody.querySelectorAll('tr').forEach(captureInitialOrderFor);
    // ë³€ê²½ ê°ì‹œ
    new MutationObserver(muts => {
      if (sortedActive) return; // ì •ë ¬ ì¤‘ì—ëŠ” ê¸°ì¤€ ìˆœì„œ ê°±ì‹  ì •ì§€
      muts.forEach(m => {
        m.addedNodes.forEach(n => { if (n.nodeType===1 && n.tagName==='TR') captureInitialOrderFor(n); });
        m.removedNodes.forEach(n => {
          if (n.nodeType===1 && n.tagName==='TR' && n.dataset && n.dataset.id) {
            const idx = originalOrder.findIndex(x => x.tr === n);
            if (idx >= 0) { originalOrder.splice(idx, 1); idSet.delete(n.dataset.id); }
          }
        });
      });
    }).observe(tbody, { childList: true });
  }
  buildObserver();

  const sortStates = { receiptDate: 1, shipDate: 1, completeDate: 1 }; // 1:ASC, -1:DESC

  function labelReset(){
    dock.querySelectorAll('button.sort-btn').forEach(b => {
      if (b.dataset.field) b.textContent = (b.textContent.replace(/[â†‘â†“]/g,'').trim()) + 'â†‘â†“';
      b.classList.remove('active');
    });
  }

  function getDateValue(tr, field){
    const input = tr.querySelector(`input[data-key="${field}"]`);
    return (input && input.value) ? input.value : ""; // YYYY-MM-DD í˜•íƒœì´ë¯€ë¡œ ë¬¸ìì—´ ë¹„êµ OK
  }

  function applySort(field){
    const tbody = document.getElementById('tableBody');
    const rows = Array.from(tbody.querySelectorAll('tr')).filter(tr => !tr.classList.contains('expand-row'));
    const order = sortStates[field] = -sortStates[field];

    // ìƒíƒœ í‘œì‹œ
    labelReset();
    const btn = dock.querySelector(`button[data-field="${field}"]`);
    if (btn) {
      const base = btn.textContent.replace(/[â†‘â†“]/g,'').trim();
      btn.textContent = base + (order > 0 ? 'â†‘' : 'â†“');
      btn.classList.add('active');
    }

    // ì •ë ¬ ì‹¤í–‰
    rows.sort((a,b) => order * getDateValue(a, field).localeCompare(getDateValue(b, field)));

    rows.forEach(tr => {
      const ex = tr.nextElementSibling?.classList.contains('expand-row') ? tr.nextElementSibling : null;
      tbody.appendChild(tr);
      if (ex) tbody.appendChild(ex);
    });

    sortedActive = true;
  }

  function resetSort(){
    const tbody = document.getElementById('tableBody');
    originalOrder.forEach(({tr, ex}) => {
      if (document.body.contains(tr)) tbody.appendChild(tr);
      if (ex && document.body.contains(ex)) tbody.appendChild(ex);
    });
    labelReset();
    sortedActive = false;
  }

  dock.addEventListener('click', (e) => {
    const btn = e.target.closest('button.sort-btn');
    if (!btn) return;
    if (btn.hasAttribute('data-reset')) return resetSort();
    const field = btn.getAttribute('data-field');
    if (field) applySort(field);
  });
})();
</script>
</body>
</html>

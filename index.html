<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>SEA 수리&amp;재가공 현황</title>

<link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
<link rel="manifest" href="./site.webmanifest">

<!-- ===== 미리보기: 이미지 없이 텍스트만 노출 ===== -->
<meta name="description" content="자재팀·구매팀을 위한 실시간 수리·재가공 현황 관리 웹사이트">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:title" content="SEA 수리&amp;재가공 현황">
<meta property="og:description" content="자재팀·구매팀을 위한 실시간 수리·재가공 현황 관리 웹사이트">
<meta property="og:url" content="https://johnchoi112.github.io/repair-sea/">
<meta property="og:site_name" content="SEA 현황">
<meta property="og:locale" content="ko_KR">

<!-- Twitter Card (텍스트형) -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SEA 수리&amp;재가공 현황">
<meta name="twitter:description" content="자재팀·구매팀을 위한 실시간 수리·재가공 현황 관리 웹사이트">

<style>
  * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
  body { background: #f5f7fa; margin: 0; padding: 20px; }
  .container { max-width: 2000px; margin: 0 auto; }
  .header { text-align: center; padding: 20px; margin-bottom: 60px;
            border-radius: 15px; color:#fff;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 8px 32px rgba(0,0,0,.1); position: relative; }
  .header h1 { margin: 0; font-size: 2.1rem; font-weight: 800; letter-spacing: .02em; }

  .controls { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:20px; margin-top: 60px; }
  .btn { padding: 10px 16px; border:0; border-radius:8px; color:#fff; cursor:pointer; font-weight:700;
         box-shadow: 0 4px 14px rgba(0,0,0,.12); }
  .btn-add { background: linear-gradient(135deg, #4CAF50, #45a049); }
  .btn-del { background: linear-gradient(135deg, #f44336, #da190b); }
  .btn-reg { background: linear-gradient(135deg, #2196F3, #1976D2); }

  /* 표 카드 */
  .table-container { background:#fff; border-radius:15px; box-shadow:0 8px 32px rgba(0,0,0,.08); overflow:hidden; max-height: 650px; overflow-y: auto; }
  table { width: 100%; border-collapse: collapse; table-layout: auto; }
  th, td { border:1px solid #e0e0e0; text-align:center; padding:10px 6px; }
  thead th { position: sticky; top:0; z-index:10; color:#fff;
             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
  tr:nth-child(even) { background:#fafafa; }
  tr:hover { background:#f1f6ff; }

  input[type="date"], select { width:100%; padding:6px 8px; border:1px solid #ddd; border-radius:6px; font-size:.9rem; color: #000; }
  .filter-input { width: 100%; padding: 5px 6px; border:1px solid #ddd; border-radius:6px; margin-top:6px; font-size:.8rem; }

  [contenteditable] { padding:6px; min-height:24px; border:1px solid transparent; border-radius:6px; }
  [contenteditable]:hover { border-color:#e3e3e3; }
  [contenteditable]:focus { outline:0; border-color:#2196F3; background:#fff3e0; }

  /* 너비 튜닝 */
  #mainTable th:nth-child(4),  #mainTable td:nth-child(4)  { min-width: 100px; } /* 거래처 */
  #mainTable th:nth-child(5),  #mainTable td:nth-child(5)  { min-width: 100px; } /* 품번 */
  #mainTable th:nth-child(6),  #mainTable td:nth-child(6)  { min-width: 100px; } /* 품명 */
  #mainTable th:nth-child(7),  #mainTable td:nth-child(7)  { min-width: 130px; } /* 규격 */
  #mainTable th:nth-child(10), #mainTable td:nth-child(10) { min-width: 160px; } /* 상태 */
  #mainTable th:nth-child(11), #mainTable td:nth-child(11) { min-width: 60px; }  /* 수리요청자 */
  #mainTable th:nth-child(12), #mainTable td:nth-child(12) { min-width: 100px; } /* 연락처 */
  #mainTable th:nth-child(14), #mainTable td:nth-child(14) { min-width: 60px; }  /* 수리비용 */
  #mainTable th:nth-child(15), #mainTable td:nth-child(15) { min-width: 100px; } /* 비고 */

  /* 모달 */
  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:999; }
  .modal-content { width: 420px; max-width: calc(100vw - 40px); margin: 5% auto; background:#fff; border-radius:12px;
                   padding: 16px; box-shadow:0 20px 60px rgba(0,0,0,.3); }
  .modal-header { text-align:center; font-weight:800; margin-bottom:12px; }
  .modal-table { width:100%; border-collapse: collapse; table-layout: fixed; }
  .modal-table th, .modal-table td { border:1px solid #eee; padding:6px 8px; font-size:.9rem; text-align:center; }
  .modal-table th { width: 110px; background:#fafafa; }
  .modal-input { width: 100%; padding:6px 8px; border:1px solid #ddd; border-radius:6px; color: #000; }
  .modal-footer { text-align:center; margin-top:10px; }
  .modal-btn { padding:9px 16px; border:0; border-radius:6px; cursor:pointer; color:#fff; font-weight:700; }
  .ok { background: linear-gradient(135deg, #4CAF50, #45a049); }
  .cancel { background: linear-gradient(135deg, #f44336, #da190b); margin-left:6px; }

  .sub-desc { margin-top: 6px; font-size: 0.95rem; color: #f0f0f0; font-weight: 400; }
  .author { position: absolute; right: 30px; top: 16px; font-size: 0.9rem; color: #ffffff; font-weight: bold; text-align: right; line-height: 1.2; }

  .header { position: relative; text-align: center; padding: 20px; margin-bottom: 30px; border-radius: 15px; color: #fff;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 8px 32px rgba(0,0,0,.1); }
  .header .logo { position: absolute; left: 24px; top: 50%; transform: translateY(-50%); height: 64px; width: auto; user-select: none; pointer-events: none; }

  /* 상태 배경 */
  #mainTable tbody tr { transition: background 240ms ease-in-out; }
  tr.row-status-received { background: linear-gradient(90deg, #cfe2ff 0%, #e0ecff 100%) !important; }
  tr.row-status-repairing{ background: linear-gradient(90deg, #cdebd6 0%, #e2f5ea 100%) !important; }
  tr.row-status-free     { background: linear-gradient(90deg, #ffeec6 0%, #ffe7b0 100%) !important; }
  tr.row-status-paid     { background: linear-gradient(90deg, #dcdcdc 0%, #e9e9e9 100%) !important; }
  tr.row-status-received:hover,
  tr.row-status-repairing:hover,
  tr.row-status-free:hover,
  tr.row-status-paid:hover { filter: brightness(1.0); }

  /* 모바일 */
  @media (max-width: 820px) {
    .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    #mainTable { min-width: 1100px; }
    .header { position: sticky; top: 0; z-index: 50; padding: 12px 16px; margin-bottom: 16px; border-radius: 12px; overflow: hidden; }
    .header .logo { left: 12px; height: 36px; }
    .header h1 { font-size: 1.25rem; margin: 0; line-height: 1.1; word-break: keep-all; }
    .sub-desc { font-size: .80rem; margin-top: 4px; }
    .author { top: 8px; right: 12px; font-size: .75rem; line-height: 1.1; }
  }
  @media (max-width: 400px) {
    .header { padding: 10px 12px; }
    .header .logo { height: 30px; left: 10px; }
    .header h1 { font-size: 1.1rem; }
    .sub-desc { font-size: .74rem; }
    .author { font-size: .7rem; top: 6px; right: 10px; }
  }
  @media (max-width: 820px) {
    .header h1, .header .sub-desc, .header .author { position: relative; z-index: 1; }
    .header .logo { z-index: 0; height: 26px; left: 10px; }
    .author { font-size: 0.62rem; top: 6px; right: 8px; line-height: 1.1; }
  }
  @media (max-width: 400px) {
    .header .logo { height: 22px; left: 8px; }
    .author { font-size: 0.58rem; top: 5px; right: 6px; }
  }
  @media (pointer: coarse) and (max-width: 820px) {
    .header .logo { display: none !important; }
  }

  /* === 정렬 툴바(카드 밖, 우상단) === */
  .table-tools {
    display:flex; gap:8px; justify-content:flex-end; align-items:center;
    margin: -8px 4px 8px 0; /* 카드에 더 가깝게 */
  }
  .chip {
    font-size: 0.74rem; padding: 6px 10px; border-radius: 999px;
    border: 1px solid #d8dbe3; cursor: pointer; user-select: none;
    box-shadow: 0 2px 6px rgba(0,0,0,.06);
    transition: transform .15s ease, box-shadow .15s ease, background .2s ease, border-color .2s ease;
    background: linear-gradient(180deg, #ffffff, #f8f9fb); color:#334155;
  }
  .chip:hover { transform: translateY(-1px); box-shadow: 0 4px 10px rgba(0,0,0,.08); }
  .chip:active { transform: translateY(0); }
  .chip.active { outline: none; }

  .chip-blue   { border-color:#90caf9; background: linear-gradient(135deg,#f0f7ff,#e3f2fd); color:#0b5394; }
  .chip-indigo { border-color:#b3bcff; background: linear-gradient(135deg,#eef0ff,#e8ebff); color:#2c3e7e; }
  .chip-purple { border-color:#d1b3ff; background: linear-gradient(135deg,#f5efff,#efe7ff); color:#5b2a86; }
  .chip-gray   { border-color:#cfd8dc; background: linear-gradient(135deg,#f7f9fb,#f2f4f7); color:#37474f; }

  .chip-blue.active   { background: linear-gradient(135deg,#c7e5ff,#a1d0ff); border-color:#6aaaf5; }
  .chip-indigo.active { background: linear-gradient(135deg,#dfe3ff,#cbd3ff); border-color:#94a3ff; }
  .chip-purple.active { background: linear-gradient(135deg,#eadbff,#d9c6ff); border-color:#b48cff; }
  .chip-gray.active   { background: linear-gradient(135deg,#eceff1,#e0e5e9); border-color:#b0bec5; }

  /* === [증상][진단 결과] 고정 숨김 (초기 CSS) === */
  #mainTable thead tr:first-child th:nth-child(8),
  #mainTable thead tr:first-child th:nth-child(9),
  #mainTable tbody tr td:nth-child(8),
  #mainTable tbody tr td:nth-child(9) { display: none !important; }
</style>
</head>
<body>
<div class="header">
 <img src="./logo.avif" alt="SEA logo" class="logo" />
  <h1>SEA 수리&amp;재가공 현황</h1>
  <p class="sub-desc">
    이 웹사이트는 자재팀과 구매팀을 위한 실시간 수리·재가공 현황 관리용 웹사이트 입니다.
  </p>
  <div class="author">
    <strong>made by JH</strong> <span class="contact">(010-4747-2421)</span>
  </div>
</div>

<div class="controls">
  <button class="btn btn-add" id="btnAdd">[행 추가]</button>
  <button class="btn btn-del" id="btnDelete">[행 삭제]</button>
  <button class="btn btn-reg" id="btnOpen">[접수]</button>
</div>

<!-- 🔽 정렬 툴바: 카드 밖(테이블 위, 우측 정렬) -->
<div id="sortTools" class="table-tools" aria-label="정렬 컨트롤">
  <button class="chip chip-blue"   data-field="receiptDate">접수일자↑↓</button>
  <button class="chip chip-indigo" data-field="shipDate">발송일자↑↓</button>
  <button class="chip chip-purple" data-field="completeDate">완료일↑↓</button>
  <button class="chip chip-gray"   data-reset>정렬 초기화</button>
</div>

<div class="table-container">
  <table id="mainTable">
    <thead>
      <tr>
        <th><input type="checkbox" id="checkAll" /></th>
        <th>접수일자<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(1,this.value)" /></th>
        <th>발송일자<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(2,this.value)" /></th>
        <th>거래처<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(3,this.value)" /></th>
        <th>품번<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(4,this.value)" /></th>
        <th>품명<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(5,this.value)" /></th>
        <th>규격<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(6,this.value)" /></th>
        <th>증상<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(7,this.value)" /></th>
        <th>진단 결과<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(8,this.value)" /></th>
        <th>상태<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(9,this.value)" /></th>
        <th>수리 요청자<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(10,this.value)" /></th>
        <th>연락처<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(11,this.value)" /></th>
        <th>수리완료일<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(12,this.value)" /></th>
        <th>수리비용<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(13,this.value)" /></th>
        <th>비고<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(14,this.value)" /></th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- 실시간으로 Firestore 문서를 렌더링합니다 -->
    </tbody>
  </table>
</div>

<!-- 접수 모달 -->
<div id="registerModal"
    class="modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="registerTitle"
    aria-hidden="true">
  <div class="modal-content" tabindex="-1">
    <h2 class="modal-header" id="registerTitle">신규 접수 등록</h2>
    <table class="modal-table">
      <tr><th>접수일자</th><td><input id="mReceipt" type="date" class="modal-input" /></td></tr>
      <tr><th>거래처</th><td><input id="mCompany" type="text" class="modal-input" maxlength="50" /></td></tr>
      <tr><th>품번</th><td><input id="mPartNo" type="text" class="modal-input" maxlength="50" /></td></tr>
      <tr><th>품명</th><td><input id="mPartName" type="text" class="modal-input" maxlength="100" /></td></tr>
      <tr><th>규격</th><td><input id="mSpec" type="text" class="modal-input" maxlength="100" /></td></tr>
      <tr><th>증상</th><td><input id="mSymptom" type="text" class="modal-input" maxlength="200" /></td></tr>
      <tr><th>요청인</th><td><input id="mRepairer" type="text" class="modal-input" maxlength="50" /></td></tr>
      <tr><th>연락처</th><td><input id="mContact" type="text" class="modal-input" maxlength="50" /></td></tr>
      <tr><th>비고</th><td><input id="mNote" type="text" class="modal-input" maxlength="300" /></td></tr>
    </table>
    <div class="modal-footer">
      <button class="modal-btn ok" id="mOk">[확인]</button>
      <button class="modal-btn cancel" id="mCancel">[취소]</button>
    </div>
  </div>
</div>

<!-- 앱 메인 모듈 -->
<script type="module" src="./js/main.js"></script>

<!-- 상태색 와이어링 -->
<script>
(function(){
  const MAP = {
    "접수완료": "row-status-received",
    "수리 중": "row-status-repairing",
    "수리중": "row-status-repairing",
    "무상수리완료": "row-status-free",
    "유상수리완료": "row-status-paid"
  };
  const ALL = Object.values(MAP);

  function applyStyle(row, value){
    row.classList.remove(...ALL);
    const cls = MAP[(value||"").trim()];
    if (cls) row.classList.add(cls);
  }

  function wireRow(row){
    const sel = row && row.querySelector('select[data-key="status"]');
    if (!sel || sel._rowStyleWired) return;
    sel._rowStyleWired = true;
    applyStyle(row, sel.value);
    sel.addEventListener('change', () => applyStyle(row, sel.value));
  }

  function init(){
    const tbody = document.getElementById('tableBody');
    if (!tbody) return;
    tbody.querySelectorAll('tr').forEach(wireRow);
    new MutationObserver(muts => {
      muts.forEach(m => m.addedNodes.forEach(n => {
        if (n.nodeType === 1 && n.tagName === 'TR') wireRow(n);
      }));
    }).observe(tbody, { childList: true });
  }

  document.readyState === 'loading' ?
    document.addEventListener('DOMContentLoaded', init) : init();
})();
</script>

<!-- [증상/진단] 숨김 보강 + 정렬(카드 밖 툴바) -->
<script>
(function(){
  /* ---- 1) [증상][진단 결과] 강제 숨김 ---- */
  const HIDE_INDEXES = [8, 9]; // 1-based index (체크박스 포함)

  function hideColsNow(root = document){
    const headRow = root.querySelector('#mainTable thead tr');
    if (headRow) HIDE_INDEXES.forEach(i => { const th = headRow.children[i-1]; if (th) th.style.display = 'none'; });
    root.querySelectorAll('#mainTable tbody tr').forEach(tr => {
      HIDE_INDEXES.forEach(i => { const td = tr.children[i-1]; if (td) td.style.display = 'none'; });
    });
  }

  function observeNewRowsForHide(){
    const tbody = document.getElementById('tableBody');
    if (!tbody) return;
    new MutationObserver(muts => {
      muts.forEach(m => m.addedNodes.forEach(n => {
        if (n.nodeType === 1 && n.tagName === 'TR') HIDE_INDEXES.forEach(i => {
          const td = n.children[i-1]; if (td) td.style.display = 'none';
        });
      }));
    }).observe(tbody, { childList: true });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => { hideColsNow(); observeNewRowsForHide(); });
  } else {
    hideColsNow(); observeNewRowsForHide();
  }

  /* ---- 2) 정렬 (툴바: #sortTools) ---- */
  const tools = document.getElementById('sortTools');
  if (!tools) return;

  const sortStates = { receiptDate: 1, shipDate: 1, completeDate: 1 }; // 1:ASC, -1:DESC
  let sortedActive = false;

  // 원래 순서 저장(실시간 추가/삭제 반영)
  const originalOrder = []; const idSet = new Set();
  const tbody = document.getElementById('tableBody');

  function capture(tr){
    if (tr.classList.contains('expand-row')) return;
    const id = tr.dataset?.id; if (!id || idSet.has(id)) return;
    idSet.add(id);
    const ex = tr.nextElementSibling?.classList.contains('expand-row') ? tr.nextElementSibling : null;
    originalOrder.push({ tr, ex });
  }

  function observeForOrder(){
    if (!tbody) return;
    tbody.querySelectorAll('tr').forEach(capture);
    new MutationObserver(muts => {
      if (sortedActive) return;
      muts.forEach(m => {
        m.addedNodes.forEach(n => { if (n.nodeType===1 && n.tagName==='TR') capture(n); });
        m.removedNodes.forEach(n => {
          if (n.nodeType===1 && n.tagName==='TR'){
            const idx = originalOrder.findIndex(x => x.tr === n);
            if (idx >= 0){ idSet.delete(n.dataset?.id); originalOrder.splice(idx,1); }
          }
        });
      });
    }).observe(tbody, { childList: true });
  }
  observeForOrder();

  function resetLabels(){
    tools.querySelectorAll('button.chip').forEach(b => {
      if (b.dataset.field) b.textContent = (b.textContent.replace(/[↑↓]/g,'').trim()) + '↑↓';
      b.classList.remove('active');
    });
  }

  function getDateValue(tr, field){
    const input = tr.querySelector(`input[data-key="${field}"]`);
    return input?.value || "";
  }

  function applySort(field){
    const order = sortStates[field] = -sortStates[field];
    const rows = Array.from(tbody.querySelectorAll('tr')).filter(tr => !tr.classList.contains('expand-row'));

    resetLabels();
    const btn = tools.querySelector(`button[data-field="${field}"]`);
    if (btn){ const base = btn.textContent.replace(/[↑↓]/g,'').trim(); btn.textContent = base + (order>0?'↑':'↓'); btn.classList.add('active'); }

    rows.sort((a,b) => order * getDateValue(a, field).localeCompare(getDateValue(b, field)));

    rows.forEach(tr => {
      const ex = tr.nextElementSibling?.classList.contains('expand-row') ? tr.nextElementSibling : null;
      tbody.appendChild(tr); if (ex) tbody.appendChild(ex);
    });

    sortedActive = true;
  }

  function resetSort(){
    originalOrder.forEach(({tr, ex}) => {
      if (document.body.contains(tr)) tbody.appendChild(tr);
      if (ex && document.body.contains(ex)) tbody.appendChild(ex);
    });
    resetLabels(); sortedActive = false;
  }

  tools.addEventListener('click', (e) => {
    const btn = e.target.closest('button.chip'); if (!btn) return;
    if (btn.hasAttribute('data-reset')) return resetSort();
    const field = btn.getAttribute('data-field'); if (field) applySort(field);
  });
})();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SEA 수리&재가공 현황 (localStorage 저장/복원)</title>
<style>
  * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
  body { background: #f5f7fa; margin: 0; padding: 20px; }
  .container { max-width: 2000px; margin: 0 auto; }
  .header { text-align: center; padding: 20px; margin-bottom: 18px;
            border-radius: 15px; color:#fff;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 8px 32px rgba(0,0,0,.1); }
  .header h1 { margin: 0; font-size: 2.1rem; font-weight: 800; letter-spacing: .02em; }

  .controls { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:16px; }
  .btn { padding: 10px 16px; border:0; border-radius:8px; color:#fff; cursor:pointer; font-weight:700;
         box-shadow: 0 4px 14px rgba(0,0,0,.12); }
  .btn-add { background: linear-gradient(135deg, #4CAF50, #45a049); }
  .btn-del { background: linear-gradient(135deg, #f44336, #da190b); }
  .btn-reg { background: linear-gradient(135deg, #2196F3, #1976D2); }

  .table-container { background:#fff; border-radius:15px; box-shadow:0 8px 32px rgba(0,0,0,.08); overflow:hidden; }
  table { width: 100%; border-collapse: collapse; table-layout: auto; }
  th, td { border:1px solid #e0e0e0; text-align:center; padding:10px 6px; }
  thead th { position: sticky; top:0; z-index:10; color:#fff;
             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
  tr:nth-child(even) { background:#fafafa; }
  tr:hover { background:#f1f6ff; }

  input[type="date"], select { width:100%; padding:6px 8px; border:1px solid #ddd; border-radius:6px; font-size:.9rem; }
  .filter-input { width: 100%; padding: 5px 6px; border:1px solid #ddd; border-radius:6px; margin-top:6px; font-size:.8rem; }

  [contenteditable] { padding:6px; min-height:24px; border:1px solid transparent; border-radius:6px; }
  [contenteditable]:hover { border-color:#e3e3e3; }
  [contenteditable]:focus { outline:0; border-color:#2196F3; background:#fff3e0; }

  /* 너비 튜닝: min-width만 주어 자동 레이아웃 유지 */
  /* 1 체크박스, 2 접수일자, 3 발송일자, 4 거래처, 5 품번, 6 품명, 7 규격, 8 증상, 9 진단결과,
     10 상태, 11 수리담당자, 12 연락처, 13 수리완료일, 14 수리비용, 15 비고 */
  #mainTable th:nth-child(4),  #mainTable td:nth-child(4)  { min-width: 170px; } /* 거래처 */
  #mainTable th:nth-child(5),  #mainTable td:nth-child(5)  { min-width: 150px; } /* 품번 */
  #mainTable th:nth-child(6),  #mainTable td:nth-child(6)  { min-width: 170px; } /* 품명 */
  #mainTable th:nth-child(7),  #mainTable td:nth-child(7)  { min-width: 150px; } /* 규격 */
  #mainTable th:nth-child(10), #mainTable td:nth-child(10) { min-width: 200px; } /* 상태 - 더 넓게 */
  #mainTable th:nth-child(11), #mainTable td:nth-child(11) { min-width: 140px; } /* 수리담당자 - 약간 작게 */
  #mainTable th:nth-child(12), #mainTable td:nth-child(12) { min-width: 160px; } /* 연락처 */
  #mainTable th:nth-child(14), #mainTable td:nth-child(14) { min-width: 120px; } /* 수리비용 - 약간 작게 */
  #mainTable th:nth-child(15), #mainTable td:nth-child(15) { min-width: 160px; } /* 비고 */

  /* 모달 */
  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:999; }
  .modal-content { width: 420px; max-width: calc(100vw - 40px); margin: 5% auto; background:#fff; border-radius:12px;
                   padding: 16px; box-shadow:0 20px 60px rgba(0,0,0,.3); }
  .modal-header { text-align:center; font-weight:800; margin-bottom:12px; }
  .modal-table { width:100%; border-collapse: collapse; table-layout: fixed; }
  .modal-table th, .modal-table td { border:1px solid #eee; padding:6px 8px; font-size:.9rem; text-align:center; }
  .modal-table th { width: 110px; background:#fafafa; }
  .modal-input { width: 100%; padding:6px 8px; border:1px solid #ddd; border-radius:6px; }
  .modal-footer { text-align:center; margin-top:10px; }
  .modal-btn { padding:9px 16px; border:0; border-radius:6px; cursor:pointer; color:#fff; font-weight:700; }
  .ok { background: linear-gradient(135deg, #4CAF50, #45a049); }
  .cancel { background: linear-gradient(135deg, #f44336, #da190b); margin-left:6px; }
</style>
</head>
<body>
<div class="container">
  <div class="header"><h1>SEA 수리&재가공 현황</h1></div>

  <div class="controls">
    <button class="btn btn-add" id="btnAdd">[행 추가]</button>
    <button class="btn btn-del" id="btnDelete">[행 삭제]</button>
    <button class="btn btn-reg" id="btnOpen">[접수]</button>
  </div>

  <div class="table-container">
    <table id="mainTable">
      <thead>
        <tr>
          <th><input type="checkbox" id="checkAll" /></th>
          <th>접수일자<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(1,this.value)" /></th>
          <th>발송일자<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(2,this.value)" /></th>
          <th>거래처<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(3,this.value)" /></th>
          <th>품번<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(4,this.value)" /></th>
          <th>품명<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(5,this.value)" /></th>
          <th>규격<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(6,this.value)" /></th>
          <th>증상<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(7,this.value)" /></th>
          <th>진단 결과<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(8,this.value)" /></th>
          <th>상태<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(9,this.value)" /></th>
          <th>수리 담당자<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(10,this.value)" /></th>
          <th>연락처<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(11,this.value)" /></th>
          <th>수리완료일<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(12,this.value)" /></th>
          <th>수리비용<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(13,this.value)" /></th>
          <th>비고<br/><input class="filter-input" placeholder="필터" onkeyup="filterTable(14,this.value)" /></th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr>
          <td><input type="checkbox" class="rowCheck" /></td>
          <td><input type="date" /></td>
          <td><input type="date" /></td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td>
            <select>
              <option value="">선택</option>
              <option value="접수완료">접수완료</option>
              <option value="수리중">수리 중</option>
              <option value="무상수리완료">무상수리완료</option>
              <option value="유상수리완료">유상수리완료</option>
            </select>
          </td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td><input type="date" /></td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- 접수 모달 -->
<div id="registerModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <h2 class="modal-header">신규 접수 등록</h2>
    <table class="modal-table">
      <tr><th>접수일자</th><td><input id="mReceipt" type="date" class="modal-input" /></td></tr>
      <tr><th>거래처</th><td><input id="mCompany" type="text" class="modal-input" maxlength="20" /></td></tr>
      <tr><th>품번</th><td><input id="mPartNo" type="text" class="modal-input" maxlength="20" /></td></tr>
      <tr><th>품명</th><td><input id="mPartName" type="text" class="modal-input" maxlength="20" /></td></tr>
      <tr><th>규격</th><td><input id="mSpec" type="text" class="modal-input" maxlength="20" /></td></tr>
      <tr><th>증상</th><td><input id="mSymptom" type="text" class="modal-input" maxlength="20" /></td></tr>
      <tr><th>담당자</th><td><input id="mRepairer" type="text" class="modal-input" maxlength="20" /></td></tr>
      <tr><th>연락처</th><td><input id="mContact" type="text" class="modal-input" maxlength="20" /></td></tr>
      <tr><th>비고</th><td><input id="mNote" type="text" class="modal-input" maxlength="20" /></td></tr>
    </table>
    <div class="modal-footer">
      <button class="modal-btn ok" id="mOk">[확인]</button>
      <button class="modal-btn cancel" id="mCancel">[취소]</button>
    </div>
  </div>
</div>

<script>
const STORAGE_KEY = "seaRepairTable_v3";

const tbody = document.getElementById("tableBody");
const checkAll = document.getElementById("checkAll");
document.getElementById("btnAdd").addEventListener("click", addRow);
document.getElementById("btnDelete").addEventListener("click", deleteSelected);
document.getElementById("btnOpen").addEventListener("click", openModal);

checkAll.addEventListener("change", () => {
  document.querySelectorAll(".rowCheck").forEach(cb => cb.checked = checkAll.checked);
});

/* ---------- table ops ---------- */
function addRow(prefill) {
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td><input type="checkbox" class="rowCheck" /></td>
    <td><input type="date" /></td>
    <td><input type="date" /></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td>
      <select>
        <option value="">선택</option>
        <option value="접수완료">접수완료</option>
        <option value="수리중">수리 중</option>
        <option value="무상수리완료">무상수리완료</option>
        <option value="유상수리완료">유상수리완료</option>
      </select>
    </td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td><input type="date" /></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  `;
  tbody.appendChild(tr);
  if (prefill) fillRowWithModal(tr, prefill);
  attachRowListeners(tr);
  saveTable();
}

function deleteSelected() {
  const rows = Array.from(tbody.querySelectorAll("tr"));
  rows.forEach(r => {
    const cb = r.querySelector(".rowCheck");
    if (cb && cb.checked) r.remove();
  });
  saveTable();
}

/* ---------- modal ---------- */
const modal = document.getElementById("registerModal");
document.getElementById("mOk").addEventListener("click", () => {
  const pre = {
    receipt: document.getElementById("mReceipt").value,
    company: document.getElementById("mCompany").value,
    partNo: document.getElementById("mPartNo").value,
    partName: document.getElementById("mPartName").value,
    spec: document.getElementById("mSpec").value,
    symptom: document.getElementById("mSymptom").value,
    repairer: document.getElementById("mRepairer").value,
    contact: document.getElementById("mContact").value,
    note: document.getElementById("mNote").value
  };
  addRow(pre);
  closeModal();
});

document.getElementById("mCancel").addEventListener("click", closeModal);
modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });
document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

function openModal() {
  modal.style.display = "block";
  document.body.style.overflow = "hidden";
  modal.querySelectorAll("input").forEach(i => i.value = "");
}
function closeModal() {
  modal.style.display = "none";
  document.body.style.overflow = "";
}
function fillRowWithModal(tr, pre) {
  const tds = tr.children;
  if (pre.receipt) tds[1].querySelector("input").value = pre.receipt;
  tds[3].innerText = pre.company || "";
  tds[4].innerText = pre.partNo || "";
  tds[5].innerText = pre.partName || "";
  tds[6].innerText = pre.spec || "";
  tds[7].innerText = pre.symptom || "";
  tds[10].innerText = pre.repairer || "";
  tds[11].innerText = pre.contact || "";
  tds[14].innerText = pre.note || "";
}

/* ---------- filter ---------- */
function filterTable(colIndex, term) {
  const rows = tbody.querySelectorAll("tr");
  const q = (term || "").toLowerCase();
  rows.forEach(r => {
    const cell = r.cells[colIndex];
    const text = cell ? (cell.innerText || cell.textContent || "").toLowerCase() : "";
    r.style.display = text.indexOf(q) > -1 ? "" : "none";
  });
}

/* ---------- persistence ---------- */
function serialize() {
  const rows = [];
  tbody.querySelectorAll("tr").forEach(r => {
    const cells = [];
    Array.from(r.cells).forEach((c, i) => {
      if (i === 0) { cells.push(null); return; } // checkbox skip
      const input = c.querySelector("input");
      const sel = c.querySelector("select");
      if (input) cells.push(input.value);
      else if (sel) cells.push(sel.value);
      else cells.push(c.innerText);
    });
    rows.push(cells);
  });
  return rows;
}

function deserialize(rows) {
  tbody.innerHTML = "";
  (rows || []).forEach(cells => {
    addRow();
    const tr = tbody.lastElementChild;
    Array.from(tr.cells).forEach((c, i) => {
      if (i === 0) return;
      const input = c.querySelector("input");
      const sel = c.querySelector("select");
      const v = cells[i-1] ?? "";
      if (input) input.value = v;
      else if (sel) sel.value = v;
      else c.innerText = v;
    });
  });
  if (!rows || rows.length === 0) attachAllListeners(); // initial row
}

function saveTable() {
  const data = serialize();
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function loadTable() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) { attachAllListeners(); return; }
    const data = JSON.parse(raw);
    deserialize(data);
  } catch(e) {
    console.warn("loadTable failed", e);
    attachAllListeners();
  }
}

function attachRowListeners(tr) {
  tr.addEventListener("input", saveTable, true);
  tr.addEventListener("change", saveTable, true);
  tr.querySelectorAll("[contenteditable]").forEach(el => {
    el.addEventListener("blur", saveTable);
  });
}
function attachAllListeners() {
  tbody.querySelectorAll("tr").forEach(attachRowListeners);
}

loadTable();
</script>
</body>
</html>
